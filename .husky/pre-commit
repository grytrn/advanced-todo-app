#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üöÄ Running pre-commit checks..."

# Run lint-staged
npx lint-staged

# Check for forbidden patterns
echo "üîç Checking for console.log statements..."
if grep -r "console\.log" --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" ./backend/src ./frontend/src 2>/dev/null; then
  echo "‚ùå Error: console.log found in source files. Use proper logging instead."
  exit 1
fi

echo "üîç Checking for 'any' types..."
if grep -r ": any" --include="*.ts" --include="*.tsx" ./backend/src ./frontend/src ./shared 2>/dev/null; then
  echo "‚ùå Error: 'any' type found in TypeScript files. Use proper types."
  exit 1
fi

echo "üîç Checking for hardcoded secrets..."
if grep -rE "(password|secret|api_key|apikey|token)\s*=\s*[\"'][^\"']+[\"']" \
  --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" \
  ./backend/src ./frontend/src 2>/dev/null | \
  grep -v ".example" | \
  grep -v "test" | \
  grep -v "spec"; then
  echo "‚ùå Error: Possible hardcoded secrets found. Use environment variables."
  exit 1
fi

echo "üîç Checking for TODO comments..."
if grep -r "TODO" --include="*.ts" --include="*.tsx" ./backend/src ./frontend/src 2>/dev/null; then
  echo "‚ö†Ô∏è  Warning: TODO comments found. Consider creating issues instead."
  # Don't fail on TODOs, just warn
fi

echo "‚úÖ All pre-commit checks passed!"
